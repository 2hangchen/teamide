name: user/update
args:
  - name: user
    type: user
steps:
  # 验证参数合法性
  - if: util.isNull(user)
    error: USER_IS_NULL
  - if: util.isEmpty(user.userId)
    error: USER_ID_IS_EMPTY

  # 查询账号
  - if: util.isNotEmpty(user.account)
    dao: user/userExist
    args:
      - user.account
    setVar: userExist

    steps:
      # 账号存在则抛出相应异常
      - if: userExist
        error: USER_ACCOUNT_ALREADY_EXIST

  # 更新
  - dao: user/update
    table: TB_USER
    args:
      - user
    setVar: updateCount

  # 账号存在则抛出相应异常
  - if: updateCount == 0
    error: USER_IS_NOT_EXIST

  # 查询用户
  - dao: user/get
    args:
      - userId
    setVar: selectUser
    setVarType: user
    steps:
      # 插入redis
      - if: util.isNotNull(selectUser)
        redis: set
        key: user-${selectUser.userId}
        value: selectUser
        expire: USER_REDIS_EXPIRE

return: selectUser