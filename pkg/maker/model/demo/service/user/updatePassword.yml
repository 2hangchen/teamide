name: user/updatePassword
inParams:
  - name: userId
    type: i64
  - name: oldPassword
  - name: newPassword
steps:
  # 验证参数合法性
  - if: util.isEmpty(userId)
    error: USER_ID_IS_EMPTY
  - if: util.isEmpty(oldPassword)
    error: USER_OLD_PASSWORD_IS_EMPTY
  - if: util.isEmpty(newPassword)
    error: USER_NEW_PASSWORD_IS_EMPTY

  # 查询
  - db: selectOne
    table: TB_USER
    columns:
      - *
    wheres:
      - name: userId
        value: userId
    var: user
    varType: user

  # 判断用户是否存在
  - if: user == null
    error: USER_IS_NOT_EXIST

  # 加密输入的密码
  - vars:
      # 生成 密码
      - name: md5OldPassword
        value: util.md5(user.salt + oldPassword)
      - name: md5NewPassword
        value: util.md5(user.salt + newPassword)

  # 判断密码是否一致
  - if: util.notEquals(md5OldPassword, user.password)
    error: USER_OLD_PASSWORD_IS_ERROR

  # 更新
  - db: update
    table: TB_USER
    columns:
      - name: password
        value: md5NewPassword
    wheres:
      - name: userId
        value: userId